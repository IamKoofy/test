def getEc2Instance(instanceID, params) {
    def ec2Instance = [:]
    withAWS(credentials: "gbt-devops-${params.AWS_ACCOUNT}-${params.AWS_ENVIRONMENT}", region: 'us-east-1') {
        sh "aws ec2 describe-instances --instance-ids ${instanceID} --output json > ./instance.json"
        def instance = readJSON file: './instance.json'
        ec2Instance['instanceId'] = instance.Reservations[0].Instances[0].InstanceId
        ec2Instance['instanceName'] = instance.Reservations[0].Instances[0].Tags.find { it.Key == 'Name' }?.Value ?: instance.Reservations[0].Instances[0].InstanceId
        ec2Instance['instanceState'] = instance.Reservations[0].Instances[0].State.Name
    }
    return ec2Instance
}

def getEc2InstanceList(params) {
    sh "aws ec2 describe-instances --filters Name=tag-value,Values='${params.APP_NAME}' --output text --query 'Reservations[*].Instances[*].InstanceId' > ./instance_id.list"
    readFile(file: './instance_id.list').readLines()
}
