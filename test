from awx.awx import AWX
from openpyxl import Workbook

# Replace with your AWX details
awx_url = "your_awx_url"
username = "your_username"
password = "your_password"

# Connect to AWX
connection = AWX(url=awx_url, username=username, password=password)

# Get user list
users = connection.get_all("users")

# Create Excel workbook
wb = Workbook()
sheet = wb.active

# Set headers
sheet.cell(row=1, column=1).value = "Username"
sheet.cell(row=1, column=2).value = "First Name"
sheet.cell(row=1, column=3).value = "Last Name"
sheet.cell(row=1, column=4).value = "Email"

# Write user data
row_num = 2
for user in users:
    sheet.cell(row=row_num, column=1).value = user["username"]
    sheet.cell(row=row_num, column=2).value = user.get("first_name", "")  # Handle missing values
    sheet.cell(row=row_num, column=3).value = user.get("last_name", "")
    sheet.cell(row=num_row, column=4).value = user.get("email", "")
    row_num += 1

# Save the Excel file
wb.save("awx_users.xlsx")

print("User list exported to awx_users.xlsx")
